<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Pain Scale Table</title>
  <style>
    html,body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;
      background:#fff;
      margin:0;
      width:600px;
      max-width:600px;
      overflow-x:auto;
      overflow-y:hidden;
      touch-action:pan-x;
      -ms-touch-action:pan-x;
      -webkit-overflow-scrolling:touch;
      color:#000;
    }
    .container{
      width:600px;
      max-width:600px;
      margin:0 auto;
      padding:0;
      box-sizing:border-box;
      background:transparent;
    }
    p.lead{
      margin:0 0 12px;
      color:#000;
      font-size:0.9rem;
    }
    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0 2px;
      font-size:0.85rem;
      table-layout:fixed;
    }
    th,td{
      padding:4px 2px;
      text-align:center;
      vertical-align:middle;
      border:none;
    }
    th{white-space:normal;word-break:break-word}
    th:nth-child(1), td:nth-child(1){width:34%}
    th:nth-child(2), td:nth-child(2),
    th:nth-child(3), td:nth-child(3),
    th:nth-child(4), td:nth-child(4),
    th:nth-child(5), td:nth-child(5){width:13%}
    th:nth-child(6), td:nth-child(6){width:42px}
    .area-cell{
      position:relative;
      width:100%;
      min-height:40px;
    }
    .area-select,
    .area-other,
    select.pain-select{
      width:100%;
      height:40px;
      min-height:40px;
      padding:0 12px;
      border-radius:6px;
      border:1px solid #d6e6f6;
      font-size:0.85rem;
      background:#fff;
      box-sizing:border-box;
    }
    .area-other{
      display:none;
      position:absolute;
      top:0;
      left:0;
      transform:translateY(0);
    }
    .area-other.is-active{display:block;}
    .area-select.other-hidden{visibility:hidden;}
    .add-row{
      margin-top:12px;
      font-size:0.85rem;
      padding:10px 14px;
      border-radius:6px;
      border:none;
      background:#AFBACE;
      color:#fff;
      cursor:pointer;
    }
    button{font-size:0.85rem}
    td.actions{padding:4px 0;display:flex;align-items:center;justify-content:center;}
    .delete-row{
      background:#dc3545;
      color:#fff;
      border:none;
      border-radius:6px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:40px;
      height:40px;
      padding:0;
      cursor:pointer;
      box-sizing:border-box;
    }
    .delete-row svg{
      width:16px;
      height:16px;
      fill:currentColor;
    }
    @media (max-width:480px){
      table, th, td{font-size:0.75rem;padding:4px}
      select.pain-select{width:56px;padding:6px}
    }
  </style>
</head>
<body>
  <div class="container">
    <p class="lead"><i>(0 = no pain, 10 = worst pain possible)</i></p>

    <form id="pain-form">
      <table id="pain-table">
        <thead>
          <tr>
            <th>Area of Body</th>
            <th>Good Day</th>
            <th>Normal Day</th>
            <th>Bad Day</th>
            <th>Today</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="rows">
          <tr>
            <td>
              <div class="area-cell">
                <select name="area_1_select" class="area-select">
                  <option value="" selected disabled>-- Select --</option>
                  <option value="Head">Head</option>
                  <option value="Face">Face</option>
                  <option value="Neck">Neck</option>
                  <option value="Back">Back</option>
                  <option value="Left arm">Left arm</option>
                  <option value="Right arm">Right arm</option>
                  <option value="Left shoulder">Left shoulder</option>
                  <option value="Right shoulder">Right shoulder</option>
                  <option value="Left elbow">Left elbow</option>
                  <option value="Right elbow">Right elbow</option>
                  <option value="Left wrist">Left wrist</option>
                  <option value="Right wrist">Right wrist</option>
                  <option value="Left hand">Left hand</option>
                  <option value="Right hand">Right hand</option>
                  <option value="Left thumb">Left thumb</option>
                  <option value="Right thumb">Right thumb</option>
                  <option value="Left index finger">Left index finger</option>
                  <option value="Right index finger">Right index finger</option>
                  <option value="Left middle finger">Left middle finger</option>
                  <option value="Right middle finger">Right middle finger</option>
                  <option value="Left ring finger">Left ring finger</option>
                  <option value="Right ring finger">Right ring finger</option>
                  <option value="Left little finger">Left little finger</option>
                  <option value="Right little finger">Right little finger</option>
                  <option value="Left hip or pelvis">Left hip or pelvis</option>
                  <option value="Right hip or pelvis">Right hip or pelvis</option>
                  <option value="Left upper leg">Left upper leg</option>
                  <option value="Right upper leg">Right upper leg</option>
                  <option value="Left Knee">Left Knee</option>
                  <option value="Right Knee">Right Knee</option>
                  <option value="Left lower leg">Left lower leg</option>
                  <option value="Right lower leg">Right lower leg</option>
                  <option value="Left ankle">Left ankle</option>
                  <option value="Right ankle">Right ankle</option>
                  <option value="Left foot">Left foot</option>
                  <option value="Right foot">Right foot</option>
                  <option value="Other">Other</option>
                </select>
                <input type="text" name="area_1_other" class="area-other" placeholder="Please enter area of body" disabled>
                <input type="hidden" name="area_1" value="">
              </div>
            </td>
            <td>
              <select name="good_1" class="pain-select">
                <option value="" selected disabled>--</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
              </select>
            </td>
            <td>
              <select name="normal_1" class="pain-select">
                <option value="" selected disabled>--</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
              </select>
            </td>
            <td>
              <select name="bad_1" class="pain-select">
                <option value="" selected disabled>--</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
              </select>
            </td>
            <td>
              <select name="today_1" class="pain-select">
                <option value="" selected disabled>--</option>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
              </select>
            </td>
            <td class="actions">
              <button type="button" class="delete-row" aria-label="Delete row">
                <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
                  <path d="M9 3a1 1 0 0 0-.894.553L7.382 5H5a1 1 0 1 0 0 2h14a1 1 0 1 0 0-2h-2.382l-.724-1.447A1 1 0 0 0 14.999 3H9Zm-3 6v10a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V9H6Zm4 2a1 1 0 0 1 2 0v8a1 1 0 1 1-2 0v-8Zm4-1a1 1 0 0 1 1 1v8a1 1 0 1 1-2 0v-8a1 1 0 0 1 1-1Z"/>
                </svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <button type="button" class="add-row" id="add-row">+ Add New Area</button>
    </form>
  </div>

  <script>
    let rowCount = 1;
    const storageKey = 'painScaleDetailed';
    let isRestoring = false;

    function valueOf(tr, selector){
      const el = tr.querySelector(selector);
      return el ? el.value : '';
    }

    function painSelectHtml(name){
      let opts = '<option value="" selected disabled>--</option>';
      for (let i = 0; i <= 10; i++) {
        opts += `<option value="${i}">${i}</option>`;
      }
      return `<select name="${name}" class="pain-select">${opts}</select>`;
    }

    const AREAS = [
      'Head','Face','Neck','Back','Left arm','Right arm','Left shoulder','Right shoulder',
      'Left elbow','Right elbow','Left wrist','Right wrist','Left hand','Right hand','Left thumb','Right thumb',
      'Left index finger','Right index finger','Left middle finger','Right middle finger','Left ring finger','Right ring finger',
      'Left little finger','Right little finger','Left hip or pelvis','Right hip or pelvis','Left upper leg','Right upper leg',
      'Left Knee','Right Knee','Left lower leg','Right lower leg','Left ankle','Right ankle','Left foot','Right foot','Other'
    ];

    function areaOptionsHtml(){
      let opts = '<option value="" selected disabled>-- Select --</option>';
      for (const a of AREAS){ opts += `<option value="${a}">${a}</option>`; }
      return opts;
    }

    function areaSelectHtml(index){
      return `
        <div class="area-cell">
          <select name="area_${index}_select" class="area-select">${areaOptionsHtml()}</select>
          <input type="text" name="area_${index}_other" class="area-other" placeholder="Please enter area of body" disabled>
          <input type="hidden" name="area_${index}" value="">
        </div>
      `;
    }

    function autosave(){
      if (isRestoring) return;
      try{
        const rows = Array.from(document.querySelectorAll('#rows tr')).map(tr => {
          const areaSelect = tr.querySelector('.area-select');
          const areaOther = tr.querySelector('.area-other');
          const hiddenArea = tr.querySelector('input[type="hidden"]');
          return {
            areaSelect: areaSelect ? areaSelect.value : '',
            areaOther: areaOther ? areaOther.value : '',
            hiddenArea: hiddenArea ? hiddenArea.value : '',
            good: valueOf(tr, 'select[name^="good_"]'),
            normal: valueOf(tr, 'select[name^="normal_"]'),
            bad: valueOf(tr, 'select[name^="bad_"]'),
            today: valueOf(tr, 'select[name^="today_"]')
          };
        });
        localStorage.setItem(storageKey, JSON.stringify({ rows }));
      } catch(err){
        // Swallow storage errors (quota, disabled storage, etc.)
      }
    }

    function appendRow(){
      rowCount++;
      const tbody = document.getElementById('rows');
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${areaSelectHtml(rowCount)}</td>
        <td>${painSelectHtml(`good_${rowCount}`)}</td>
        <td>${painSelectHtml(`normal_${rowCount}`)}</td>
        <td>${painSelectHtml(`bad_${rowCount}`)}</td>
        <td>${painSelectHtml(`today_${rowCount}`)}</td>
        <td class="actions">
          <button type="button" class="delete-row" aria-label="Delete row">
            <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
              <path d="M9 3a1 1 0 0 0-.894.553L7.382 5H5a1 1 0 1 0 0 2h14a1 1 0 1 0 0-2h-2.382l-.724-1.447A1 1 0 0 0 14.999 3H9Zm-3 6v10a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V9H6Zm4 2a1 1 0 0 1 2 0v8a1 1 0 1 1-2 0v-8Zm4-1a1 1 0 0 1 1 1v8a1 1 0 1 1-2 0v-8a1 1 0 0 1 1-1Z"/>
            </svg>
          </button>
        </td>
      `;
      tbody.appendChild(tr);
      syncDeleteButtonSizes();
      return tr;
    }

    function restoreFromStorage(){
      let stored;
      try{
        stored = localStorage.getItem(storageKey);
        if (!stored) return false;
      } catch(err){
        return false;
      }
      let data;
      try{
        data = JSON.parse(stored);
      } catch(err){
        return false;
      }
      if (!data || !Array.isArray(data.rows)) return false;
      const tbody = document.getElementById('rows');
      if (!tbody) return false;

      isRestoring = true;
      while (tbody.rows.length < data.rows.length){
        appendRow();
      }
      rowCount = tbody.rows.length;
      const rows = Array.from(tbody.querySelectorAll('tr'));
      data.rows.forEach((rowData, idx) => {
        const tr = rows[idx];
        if (!tr) return;
        const areaSelect = tr.querySelector('.area-select');
        if (areaSelect){
          areaSelect.value = rowData.areaSelect || '';
          areaSelect.dispatchEvent(new Event('change', { bubbles: true }));
        }
        const areaOther = tr.querySelector('.area-other');
        if (areaOther){
          areaOther.value = rowData.areaOther || '';
          if (areaSelect && areaSelect.value === 'Other'){
            areaOther.disabled = false;
            areaOther.classList.add('is-active');
            areaSelect.classList.add('other-hidden');
            areaOther.dispatchEvent(new Event('input', { bubbles: true }));
          }
        }
        const hiddenArea = tr.querySelector('input[type="hidden"]');
        if (hiddenArea){
          if (rowData.hiddenArea){
            hiddenArea.value = rowData.hiddenArea;
          } else if (areaSelect){
            hiddenArea.value = areaSelect.value === 'Other'
              ? (areaOther ? areaOther.value.trim() : '')
              : areaSelect.value;
          }
        }
        const mappings = [
          ['select[name^="good_"]', 'good'],
          ['select[name^="normal_"]', 'normal'],
          ['select[name^="bad_"]', 'bad'],
          ['select[name^="today_"]', 'today']
        ];
        mappings.forEach(([selector, key]) => {
          const sel = tr.querySelector(selector);
          if (sel){
            sel.value = rowData[key] || '';
          }
        });
      });
      isRestoring = false;
      autosave();
      syncDeleteButtonSizes();
      return true;
    }

    document.getElementById('rows').addEventListener('input', autosave);
    document.getElementById('rows').addEventListener('change', autosave);

    // Show/hide Other field and keep a single area_* value
    document.getElementById('rows').addEventListener('change', function(e){
      if (e.target.matches('select.area-select')){
        const td = e.target.closest('td');
        const m = e.target.name.match(/area_(\d+)_select/);
        if (!m) return;
        const idx = m[1];
        const other = td.querySelector(`input[name="area_${idx}_other"]`);
        const hidden = td.querySelector(`input[name="area_${idx}"]`);
        if (e.target.value === 'Other'){
          other.disabled = false;
          other.classList.add('is-active');
          e.target.classList.add('other-hidden');
          requestAnimationFrame(() => other.focus());
          hidden.value = other.value.trim();
        } else {
          other.value = '';
          other.disabled = true;
          other.classList.remove('is-active');
          e.target.classList.remove('other-hidden');
          hidden.value = e.target.value;
        }
        autosave();
        syncDeleteButtonSizes();
      }
    });

    document.getElementById('rows').addEventListener('input', function(e){
      if (e.target.matches('input.area-other')){
        const td = e.target.closest('td');
        const m = e.target.name.match(/area_(\d+)_other/);
        if (!m) return;
        const idx = m[1];
        const sel = td.querySelector(`select[name="area_${idx}_select"]`);
        const hidden = td.querySelector(`input[name="area_${idx}"]`);
        if (sel && sel.value === 'Other'){
          hidden.value = e.target.value.trim();
          autosave();
        }
      }
    });

    document.getElementById('add-row').addEventListener('click', function(){
      appendRow();
      autosave();
    });

    // Delegate delete row action
    document.getElementById('rows').addEventListener('click', function(e){
      if (e.target && e.target.classList.contains('delete-row')){
        const tr = e.target.closest('tr');
        if (!tr) return;
        const tbody = tr.parentElement;
        const rows = tbody.querySelectorAll('tr');
        if (rows.length > 1){
          tr.remove();
        } else {
          const areaSelect = tr.querySelector('.area-select');
          const areaOther = tr.querySelector('.area-other');
          const hiddenArea = tr.querySelector('input[type="hidden"]');
          if (areaSelect){
            areaSelect.value = '';
            areaSelect.classList.remove('other-hidden');
          }
          if (areaOther){
            areaOther.value = '';
            areaOther.disabled = true;
            areaOther.classList.remove('is-active');
          }
          if (hiddenArea){ hiddenArea.value = ''; }
          tr.querySelectorAll('.pain-select').forEach(sel => {
            sel.value = '';
            sel.disabled = false;
          });
        }
        autosave();
        syncDeleteButtonSizes();
      }
    });

    function syncDeleteButtonSizes(){
      const rows = document.querySelectorAll('#pain-table tbody tr');
      if (!rows.length) return;
      const headerCell = document.querySelector('#pain-table thead th:last-child');
      requestAnimationFrame(() => {
        let latestSize = null;
        rows.forEach(row => {
          const btn = row.querySelector('.delete-row');
          if (!btn) return;
          const ref = row.querySelector('.pain-select') || row.querySelector('.area-select');
          if (!ref) return;
          const size = 40;
          btn.style.height = `${size}px`;
          btn.style.width = `${size}px`;
          const cell = btn.closest('td.actions');
          if (cell) cell.style.width = '42px';
          latestSize = size;
        });
        if (headerCell && latestSize !== null){
          headerCell.style.width = '42px';
        }
      });
    }

    window.addEventListener('load', syncDeleteButtonSizes);
    window.addEventListener('resize', syncDeleteButtonSizes);
    if (!restoreFromStorage()){
      autosave();
    }
  </script>
</body>
</html>
